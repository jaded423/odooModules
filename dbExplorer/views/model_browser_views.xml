<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <!-- Form View -->
  <record id="db_explorer_browser_form" model="ir.ui.view">
      <field name="name">db.explorer.browser.form</field>
      <field name="model">db.explorer.browser</field>
      <field name="arch" type="xml">
          <form string="Database Explorer">
              <header>
                  <button name="action_export_csv" type="object"
                          string="Export Fields to CSV"
                          class="btn-primary"
                          icon="fa-download"/>
              </header>
              <sheet>
                  <div class="oe_title">
                      <h1>
                          <field name="model_description" placeholder="Select a model..."/>
                      </h1>
                      <h3 class="text-muted">
                          <field name="model_name" readonly="1"/>
                      </h3>
                  </div>
                  <group>
                      <group string="Select Model">
                          <field name="model_id" options="{'no_create': True, 'no_open': True}"/>
                      </group>
                      <group string="Statistics">
                          <field name="record_count" widget="statinfo"/>
                          <field name="field_count" widget="statinfo"/>
                      </group>
                  </group>
                  <notebook>
                      <page string="Fields" name="fields" icon="fa-list">
                          <field name="field_ids" readonly="1">
                              <tree decoration-info="ttype in ('many2one','one2many','many2many')"
                                    decoration-success="required == True"
                                    decoration-muted="store == False">
                                  <field name="name" string="Technical Name"/>
                                  <field name="field_description" string="Label"/>
                                  <field name="ttype" string="Type" widget="badge"/>
                                  <field name="relation" string="Related Model"/>
                                  <field name="required" widget="boolean_toggle"/>
                                  <field name="store" string="Stored" widget="boolean_toggle"/>
                              </tree>
                          </field>
                      </page>
                      <page string="Relationships" name="relations" icon="fa-link">
                          <field name="relation_field_ids" readonly="1">
                              <tree>
                                  <field name="name" string="Field"/>
                                  <field name="field_description" string="Label"/>
                                  <field name="ttype" string="Type" widget="badge"/>
                                  <field name="relation" string="Related Model"/>
                                  <field name="relation_field" string="Inverse Field"/>
                              </tree>
                          </field>
                      </page>
                  </notebook>
              </sheet>
          </form>
      </field>
  </record>

  <!-- Search View -->
  <record id="db_explorer_browser_search" model="ir.ui.view">
      <field name="name">db.explorer.browser.search</field>
      <field name="model">ir.model</field>
      <field name="arch" type="xml">
          <search string="Search Models">
              <field name="name" string="Description"/>
              <field name="model" string="Technical Name"/>
              <separator/>
              <filter string="Has Records" name="has_records"
                      domain="[('model', 'not ilike', 'ir.%')]"/>
              <filter string="Custom Models" name="custom"
                      domain="[('model', 'like', 'x_%')]"/>
              <separator/>
              <group expand="0" string="Group By">
                  <filter string="Module" name="group_module"
                          context="{'group_by': 'modules'}"/>
              </group>
          </search>
      </field>
  </record>

  <!-- Model Selection Tree View -->
  <record id="db_explorer_model_tree" model="ir.ui.view">
      <field name="name">db.explorer.model.tree</field>
      <field name="model">ir.model</field>
      <field name="arch" type="xml">
          <tree string="Models" default_order="model">
              <field name="model" string="Technical Name"/>
              <field name="name" string="Description"/>
              <field name="modules" string="Module" optional="show"/>
              <field name="transient" string="Temporary" optional="hide"/>
          </tree>
      </field>
  </record>

  <!-- Action: Model Browser Form -->
  <record id="db_explorer_browser_action" model="ir.actions.act_window">
      <field name="name">Model Browser</field>
      <field name="res_model">db.explorer.browser</field>
      <field name="view_mode">form</field>
      <field name="target">current</field>
  </record>

  <!-- Action: Browse All Models -->
  <record id="db_explorer_model_list_action" model="ir.actions.act_window">
      <field name="name">All Models</field>
      <field name="res_model">ir.model</field>
      <field name="view_mode">tree,form</field>
      <field name="view_id" ref="db_explorer_model_tree"/>
      <field name="search_view_id" ref="db_explorer_browser_search"/>
      <field name="domain">[('transient', '=', False)]</field>
      <field name="context">{'search_default_has_records': 1}</field>
  </record>

  <!-- Root Menu -->
  <menuitem id="db_explorer_menu_root"
            name="DB Explorer"
            web_icon="db_explorer,static/description/icon.png"
            sequence="1"/>

  <!-- Submenu: Model Browser -->
  <menuitem id="db_explorer_menu_browser"
            name="Model Browser"
            parent="db_explorer_menu_root"
            action="db_explorer_browser_action"
            sequence="10"/>

  <!-- Submenu: All Models List -->
  <menuitem id="db_explorer_menu_models"
            name="All Models"
            parent="db_explorer_menu_root"
            action="db_explorer_model_list_action"
            sequence="2"/>
</odoo>
