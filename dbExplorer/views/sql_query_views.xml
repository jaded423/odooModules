<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <!-- Tree View -->
  <record id="db_explorer_query_tree" model="ir.ui.view">
      <field name="name">db.explorer.query.tree</field>
      <field name="model">db.explorer.query</field>
      <field name="arch" type="xml">
          <tree string="Saved Queries">
              <field name="sequence" widget="handle"/>
              <field name="name"/>
              <field name="category" widget="badge"
                     decoration-info="category == 'accounting'"
                     decoration-success="category == 'sales'"
                     decoration-warning="category == 'inventory'"
                     decoration-danger="category == 'hr'"/>
              <field name="description" optional="show"/>
              <field name="run_count"/>
              <field name="last_run" optional="show"/>
              <button name="action_run_query" type="object"
                      string="Run" class="btn-primary" icon="fa-play"/>
          </tree>
      </field>
  </record>

  <!-- Form View -->
  <record id="db_explorer_query_form" model="ir.ui.view">
      <field name="name">db.explorer.query.form</field>
      <field name="model">db.explorer.query</field>
      <field name="arch" type="xml">
          <form string="SQL Query">
              <header>
                  <button name="action_run_query" type="object"
                          string="Run Query" class="btn-primary" icon="fa-play"/>
              </header>
              <sheet>
                  <div class="oe_title">
                      <h1>
                          <field name="name" placeholder="Query Name..."/>
                      </h1>
                  </div>
                  <group>
                      <group>
                          <field name="category"/>
                          <field name="sequence"/>
                      </group>
                      <group>
                          <field name="run_count" readonly="1"/>
                          <field name="last_run" readonly="1"/>
                          <field name="active"/>
                      </group>
                  </group>
                  <group string="Description">
                      <field name="description" nolabel="1"
                             placeholder="What does this query do?"/>
                  </group>
                  <group string="SQL Query">
                      <field name="query" nolabel="1"
                             placeholder="SELECT * FROM res_partner LIMIT 10"/>
                  </group>
              </sheet>
          </form>
      </field>
  </record>

  <!-- Search View -->
  <record id="db_explorer_query_search" model="ir.ui.view">
      <field name="name">db.explorer.query.search</field>
      <field name="model">db.explorer.query</field>
      <field name="arch" type="xml">
          <search string="Search Queries">
              <field name="name"/>
              <field name="query"/>
              <separator/>
              <filter string="Accounting" name="accounting"
                      domain="[('category', '=', 'accounting')]"/>
              <filter string="Sales" name="sales"
                      domain="[('category', '=', 'sales')]"/>
              <filter string="Inventory" name="inventory"
                      domain="[('category', '=', 'inventory')]"/>
              <separator/>
              <filter string="Archived" name="inactive"
                      domain="[('active', '=', False)]"/>
              <group expand="0" string="Group By">
                  <filter string="Category" name="group_category"
                          context="{'group_by': 'category'}"/>
              </group>
          </search>
      </field>
  </record>

  <!-- Action -->
  <record id="db_explorer_query_action" model="ir.actions.act_window">
      <field name="name">Saved Queries</field>
      <field name="res_model">db.explorer.query</field>
      <field name="view_mode">tree,form</field>
      <field name="search_view_id" ref="db_explorer_query_search"/>
      <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
              Create your first saved query!
          </p>
          <p>
              Save frequently used SQL queries for quick access.
              Only SELECT queries are allowed for safety.
          </p>
      </field>
  </record>

  <!-- Menu -->
  <menuitem id="db_explorer_menu_queries"
            name="Saved Queries"
            parent="db_explorer_menu_root"
            action="db_explorer_query_action"
            sequence="30"/>
</odoo>
